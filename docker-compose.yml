# Docker Compose for Self-Hosted Deployment (SQLite)
version: '3.8'

services:
  vintscout:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: vintscout
    ports:
      - "3000:3000"
    environment:
      # Application Settings
      - DEPLOYMENT_MODE=self-hosted
      - DEBUG=False
      - DATABASE_URL=sqlite:////app/backend/data/vinted.db

      # Authentication
      - REQUIRE_AUTH=false
      - JWT_SECRET=${JWT_SECRET:-change-me-in-production}
      - JWT_ALGORITHM=HS256
      - ACCESS_TOKEN_EXPIRE_MINUTES=30

      # Default Admin User (first run only)
      - DEFAULT_ADMIN_EMAIL=${DEFAULT_ADMIN_EMAIL:-admin@example.com}
      - DEFAULT_ADMIN_PASSWORD=${DEFAULT_ADMIN_PASSWORD:-admin}

      # CORS
      - CORS_ORIGINS=["http://localhost:3000"]

      # Telegram Notifications (optional)
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID:-}

      # Vinted API
      - VINTED_API_TIMEOUT=30

    volumes:
      - vintscout-data:/app/backend/data  # Persist SQLite database and user data

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  vintscout-data:
